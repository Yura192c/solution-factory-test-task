# solution-factory-test-task
Тестовое задание для Solution Factory. API для рассылки 

# Start project without docker
***
***Важно!*** Для корректной работы нужно установить все переменные окружения.
<br>Список нужных для работы переменные окружения находятся в файле .env, после заполнения они автоматически присвоятся переменным окружения.
<br>Заполните их своими значениями. Переменные связанные с бд можно удалить, тогда будет использоваться sqlite3.

***Важно!*** Для запуска без докера в файле celery.py нужно закомментировать строки
 №8 и №9:
```
8             broker='amqp://rabbitmq:rabbitmq@test:5672',
9             backend='redis://redis:redis@redis:6379/0',
```
***

### Подготовка виртуального окружения
```
pip install pipenv #если ранее не установлен
pipenv sync 
pipenv shell
```
### Запуск проекта
```
python manage.py makemigrations
python manage.py migrate
python manage.py createsuperuser
python manage.py runserver
```

### Запуск Celery
```
celery -A config worker -l info
```
### Запуск Celery Beat
```
celery -A config beat -l info
```
***Важно!*** Для корректной работы Celery Beat необходимо запустить Celery Worker
***Celery и Celery Beat можно запустить одной командой:***
```
celery -A config worker --beat --loglevel=info
```
### Запуск Flower
Flower - это веб-интерфейс для мониторинга и управления задачами Celery. Его запуск необязателен.
Доступен по адресу http://127.0.0.1:5555/
```
celery -A config flower
```

### Запуск RabbitMQ
Стандартные логины и пароли для RabbitMQ: guest/guest
Доступен по адресу http://127.0.0.1:15672/#/
```
 docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:management 
```

# Start project with docker
```
docker-compose up --build
```
Далее создайте суперпользователя
```
docker-compose exec web python manage.py createsuperuser
```

# API
После запуска проекта API будет доступно по адресу
<br>http://127.0.0.1:8000/docs/ либо 
<br>http://127.0.0.1:8000/redoc
### Авторизация
Для авторизации используется админ аккаунт Django с параметрами username и password.
Аккаунт администратора можно создать через консоль командой
```
python manage.py createsuperuser
```
Аккаунт пользователя можно создать через Web интерфейс статистики по адресу: 
<br>http://127.0.0.1:8000/account/register/


# Выполненые задания
## Дополнительные задания
<br>3. подготовить docker-compose для запуска всех сервисов проекта одной командой
<br>
<br>5. сделать так, чтобы по адресу /docs/ открывалась страница со Swagger UI и в нём отображалось описание разработанного API. Пример: https://petstore.swagger.io
<br>
<br>6. реализовать администраторский Web UI для управления рассылками и получения статистики по отправленным сообщениям
<br>
<br> 8. реализовать дополнительный сервис, который раз в сутки отправляет статистику по обработанным рассылкам на email
<br>
<br> 9. удаленный сервис может быть недоступен, долго отвечать на запросы или выдавать некорректные ответы. Необходимо организовать обработку ошибок и откладывание запросов при неуспехе для последующей повторной отправки. Задержки в работе внешнего сервиса никак не должны оказывать влияние на работу сервиса рассылок.
